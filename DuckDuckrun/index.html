<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>ðŸŒ¸ Pink Ducky Jumper â€” Enhanced</title>

<style>
/* ======= ROOT VARIABLES ======= */
:root {
  --pink-bg:#ffdaf1;
  --kawaii-bg:#ffe6f9;
  --ink:#2b1030;
  --grass:#a1e6b6;
  --floor:#ffc4e2;
  --shadow:rgba(0,0,0,0.15);
  --guide-color:#68287f;
  --cloud-1:#ffffff;
  --star:#fdf5e6;
}

/* ======= RESET ======= */
* {
  margin:0;
  padding:0;
  box-sizing:border-box;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}

html, body {
  width:100vw;
  height:100vh;
  background:var(--pink-bg);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  overflow:hidden;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* ======= BACKGROUND LAYERS ======= */
#cloudLayer, #starLayer {
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:0;
}

.cloud {
  position:absolute;
  border-radius:50%;
  background:var(--cloud-1);
  opacity:0.85;
}
.cloud.small { width:80px; height:40px; }
.cloud.medium { width:130px; height:60px; }
.cloud.large { width:200px; height:90px; }

.star {
  position:absolute;
  width:2px; height:2px;
  border-radius:50%;
  background:var(--star);
  opacity:0.9;
}

/* ======= OVERLAY PANELS ======= */
.overlay {
  position:fixed;
  inset:0;
  background:rgba(255,255,255,.92);
  backdrop-filter:blur(6px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.panel {
  background:white;
  padding:22px 28px;
  border-radius:18px;
  box-shadow:0 10px 32px var(--shadow);
  text-align:center;
  width:90%;
  max-width:380px;
}
.panel h1, .panel h2 {
  font-size:24px;
  margin-bottom:12px;
}

/* ======= HEART PICKER ======= */
const heartChoicesEl = document.getElementById("heartChoices");
HEART_KEYS.forEach(key => {
  const h = document.createElement("div");
  h.className = "heart";
  h.style.background = HEARTS[key];
  h.onclick = () => {
    document.querySelectorAll(".heart").forEach(el => el.classList.remove("selectedHeart"));
    h.classList.add("selectedHeart");
    playerHeart = key;
    heartPicker.style.display = "none";
    gameContainer.style.display = "block";
    resetGame();
    cancelAnimationFrame(updateId);
    updateId = requestAnimationFrame(update);
  };
  heartChoicesEl.appendChild(h);
});
/* ======= GAME CONTAINER ======= */
#gameContainer {
  width:min(560px,92vw);
  background:var(--kawaii-bg);
  border:3px solid #ff9ad5;
  border-radius:20px;
  box-shadow:0 14px 40px var(--shadow);
  position:relative;
  padding-top:40px;
}
#score, #state {
  position:absolute;
  background:white;
  padding:6px 10px;
  border-radius:12px;
  border:2px solid #ff6bb7;
  font-size:18px;
  font-weight:bold;
  z-index:2;
}
#score { top:8px; left:12px; }
#state { top:8px; right:12px; }

canvas {
  width:100%;
  height:auto;
  background:linear-gradient(180deg,#ffe8f8 0%,#ffd6eb 60%,#ffbfe1 100%);
  border-radius:14px;
  border:2px solid rgba(43,16,48,.12);
  image-rendering:pixelated;
  margin-bottom:8px;
}

#guideText {
  text-align:center;
  font-size:14px;
  margin-top:6px;
  color:var(--guide-color);
  opacity:.85;
}

/* ======= NIGHT MODE ======= */
.nightBody { background:#0b022c !important; }
.nightCanvas { background:#1a0a3b !important; }
.night .cloud { opacity:0.2 !important; }
.night .star { opacity:1 !important; }

audio { display:none; }
</style>
</head>

<body>
<!-- ======= BACKGROUND LAYERS ======= -->
<div id="cloudLayer"></div>
<div id="starLayer"></div>

<!-- ======= HEART PICKER ======= -->
<div class="overlay" id="heartPicker">
  <div class="panel">
    <h2>Pick Your Heart ðŸ’•</h2>
    <div class="hearts" id="heartChoices"></div>
  </div>
</div>

<!-- ======= GAME OVER SCREEN ======= -->
<div class="overlay" id="gameOverScreen" style="display:none;">
  <div class="panel">
    <h1>BABY404</h1>
    <p>Game Over!</p>
    <button id="retryBtn">Retry</button>
  </div>
</div>

<!-- ======= GAME CONTAINER ======= -->
<div id="gameContainer" style="display:none;">
  <div id="score">Score: 0</div>
  <div id="state">Running</div>
  <canvas id="game" width="320" height="180"></canvas>
  <div id="guideText">Tap left/right to jump left/right</div>
</div>

<!-- ======= AUDIO ======= -->
<audio id="runnerMusic" loop>
  <source src="/mnt/data/kawaii-future-bass-no-copy-right-386527.mp3" type="audio/mpeg">
</audio>
<audio id="towerMusic" loop>
  <source src="/mnt/data/kawaii-pop-sparkle-447746.mp3" type="audio/mpeg">
</audio>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>ðŸŒ¸ Pink Ducky Jumper â€” Enhanced</title>

<style>
/* ======= ROOT VARIABLES ======= */
:root {
  --pink-bg:#ffdaf1;
  --kawaii-bg:#ffe6f9;
  --ink:#2b1030;
  --grass:#a1e6b6;
  --floor:#ffc4e2;
  --shadow:rgba(0,0,0,0.15);
  --guide-color:#68287f;
  --cloud-1:#ffffff;
  --star:#fdf5e6;
}

/* ======= RESET ======= */
* {
  margin:0;
  padding:0;
  box-sizing:border-box;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}

html, body {
  width:100vw;
  height:100vh;
  background:var(--pink-bg);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  overflow:hidden;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* ======= BACKGROUND LAYERS ======= */
#cloudLayer, #starLayer {
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:0;
}

.cloud {
  position:absolute;
  border-radius:50%;
  background:var(--cloud-1);
  opacity:0.85;
}
.cloud.small { width:80px; height:40px; }
.cloud.medium { width:130px; height:60px; }
.cloud.large { width:200px; height:90px; }

.star {
  position:absolute;
  width:2px; height:2px;
  border-radius:50%;
  background:var(--star);
  opacity:0.9;
}

/* ======= OVERLAY PANELS ======= */
.overlay {
  position:fixed;
  inset:0;
  background:rgba(255,255,255,.92);
  backdrop-filter:blur(6px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.panel {
  background:white;
  padding:22px 28px;
  border-radius:18px;
  box-shadow:0 10px 32px var(--shadow);
  text-align:center;
  width:90%;
  max-width:380px;
}
.panel h1, .panel h2 {
  font-size:24px;
  margin-bottom:12px;
}

/* ======= HEART PICKER ======= */
.hearts {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:12px;
  margin-top:14px;
}
.heart {
  width:40px;
  height:40px;
  border-radius:50%;
  border:3px solid var(--ink);
  cursor:pointer;
  transition:transform .2s, border-color .2s;
}
.heart:hover { transform:scale(1.3); border-color:var(--ink); }
.selectedHeart { transform:scale(1.5); border-color:var(--ink); }

/* ======= GAME CONTAINER ======= */
#gameContainer {
  width:min(560px,92vw);
  background:var(--kawaii-bg);
  border:3px solid #ff9ad5;
  border-radius:20px;
  box-shadow:0 14px 40px var(--shadow);
  position:relative;
  padding-top:40px;
}
#score, #state {
  position:absolute;
  background:white;
  padding:6px 10px;
  border-radius:12px;
  border:2px solid #ff6bb7;
  font-size:18px;
  font-weight:bold;
  z-index:2;
}
#score { top:8px; left:12px; }
#state { top:8px; right:12px; }

canvas {
  width:100%;
  height:auto;
  background:linear-gradient(180deg,#ffe8f8 0%,#ffd6eb 60%,#ffbfe1 100%);
  border-radius:14px;
  border:2px solid rgba(43,16,48,.12);
  image-rendering:pixelated;
  margin-bottom:8px;
}

#guideText {
  text-align:center;
  font-size:14px;
  margin-top:6px;
  color:var(--guide-color);
  opacity:.85;
}

/* ======= NIGHT MODE ======= */
.nightBody { background:#0b022c !important; }
.nightCanvas { background:#1a0a3b !important; }
.night .cloud { opacity:0.2 !important; }
.night .star { opacity:1 !important; }

audio { display:none; }
</style>
</head>

<body>
<!-- ======= BACKGROUND LAYERS ======= -->
<div id="cloudLayer"></div>
<div id="starLayer"></div>

<!-- ======= HEART PICKER ======= -->
<div class="overlay" id="heartPicker">
  <div class="panel">
    <h2>Pick Your Heart ðŸ’•</h2>
    <div class="hearts" id="heartChoices"></div>
  </div>
</div>

<!-- ======= GAME OVER SCREEN ======= -->
<div class="overlay" id="gameOverScreen" style="display:none;">
  <div class="panel">
    <h1>BABY404</h1>
    <p>Game Over!</p>
    <button id="retryBtn">Retry</button>
  </div>
</div>

<!-- ======= GAME CONTAINER ======= -->
<div id="gameContainer" style="display:none;">
  <div id="score">Score: 0</div>
  <div id="state">Running</div>
  <canvas id="game" width="320" height="180"></canvas>
  <div id="guideText">Tap left/right to jump left/right</div>
</div>

<!-- ======= AUDIO ======= -->
<audio id="runnerMusic" loop>
  <source src="/mnt/data/kawaii-future-bass-no-copy-right-386527.mp3" type="audio/mpeg">
</audio>
<audio id="towerMusic" loop>
  <source src="/mnt/data/kawaii-pop-sparkle-447746.mp3" type="audio/mpeg">
</audio>
<script>
/* ======= UPDATE LOOP ======= */
function update() {
  frame++;

  // Skull / game over logic
  if(skullMode && --skullTimer <= 0) {
    skullMode = false;
    showBaby404 = true;
    gameOverScreen.style.display = "flex";
    return;
  }

  if(!gameOver && playerHeart){
    // Gravity
    duck.vy += GRAVITY;
    duck.y += duck.vy;

    // Runner world
    if(world === "runner"){
      if(duck.y >= GROUND - duck.h){ duck.y = GROUND - duck.h; duck.vy = 0; duck.onGround = true; }
      if(frame % 85 === 0) spawnObstacle();
      obstacles.forEach(o => o.x -= SPEED);
      obstacles.forEach(o => {
        if(!o.passed && o.x + o.w < duck.x){
          o.passed = true;
          score += 10;
          scoreEl.textContent = "Score: " + score;
          if(score % 100 === 0) duckColorIndex = (duckColorIndex + 1) % DUCK_COLORS.length;
          SPEED += 0.1;
        }
        if(hit(duck,o)) killDuck();
      });
      if(score >= 150 && !secretDoor) spawnSecretDoor();
      if(secretDoor){
        secretDoor.x -= SPEED;
        secretDoor.hue = (secretDoor.hue + 3) % 360;
        const hitDoor = duck.onGround && duck.x + duck.w > secretDoor.x && duck.x < secretDoor.x + secretDoor.w;
        if(hitDoor){
          world = "tower";
          duck.y = 120;
          duck.vy = 0;
          platforms = [];
          for(let i=0;i<6;i++) spawnPlatform(140-i*30);
          secretDoor = null;
          towerMusic.play();
        }
      }
    }

    // Tower world
    if(world === "tower"){
      duck.onGround = false;
      platforms.forEach(p => {
        if(duck.x + duck.w > p.x && duck.x < p.x + p.w && duck.y + duck.h >= p.y && duck.y + duck.h <= p.y + 6 && duck.vy >= 0){
          duck.y = p.y - duck.h;
          duck.vy = 0;
          duck.onGround = true;
        }
      });
      if(duck.y < 60){
        duck.y += 40;
        platforms.forEach(p => p.y += 40);
        spawnPlatform(0);
        score += 5;
        scoreEl.textContent = "Score: " + score;
      }

      fireDelay++;
      if(fireDelay >= FIRE_DELAY_FRAMES){
        fireY -= fireSpeed;
        fireSpeed += 0.0003;
        if(duck.y + duck.h > fireY) killDuck();
      }
    }

    // Sparkles decay
    sparkles.forEach(p => { p.x += p.vx; p.y += p.vy; p.life--; });
    sparkles = sparkles.filter(p => p.life > 0);
  }

  draw();
  updateId = requestAnimationFrame(update);
}

/* ======= RETRY BUTTON ======= */
retryBtn.onclick = () => {
  gameOverScreen.style.display = "none";
  cancelAnimationFrame(updateId);
  resetGame();
  updateId = requestAnimationFrame(update);
};

/* ======= BACKGROUND: CLOUDS / STARS ======= */
function spawnClouds(){
  const gameWidth = canvas.width, gameHeight = canvas.height;
  for(let i=0;i<8;i++){
    const c = document.createElement("div");
    const size = ["small","medium","large"][Math.floor(Math.random()*3)];
    c.className = `cloud ${size}`;
    const w = size==="small"?80:size==="medium"?130:200;
    const h = size==="small"?40:size==="medium"?60:90;
    c.style.top = `${Math.random()*(gameHeight-h)}px`;
    c.style.left = `${Math.random()*(gameWidth-w)}px`;
    c.style.opacity = 0.4 + Math.random()*0.4;
    cloudLayer.appendChild(c);
  }
}

function spawnStars(){
  const gameWidth = canvas.width, gameHeight = canvas.height;
  for(let i=0;i<40;i++){
    const s = document.createElement("div");
    s.className = "star";
    s.style.top = `${Math.random()*gameHeight}px`;
    s.style.left = `${Math.random()*gameWidth}px`;
    starLayer.appendChild(s);
  }
}

function animateBackground(){
  const gameWidth = canvas.width, gameHeight = canvas.height;

  document.querySelectorAll('.cloud').forEach(cloud=>{
    let x = parseFloat(cloud.style.left);
    x -= 0.1;
    if(x < -cloud.offsetWidth) x = gameWidth;
    cloud.style.left = x + 'px';
  });

  document.querySelectorAll('.star').forEach(star=>{
    let y = parseFloat(star.style.top);
    y += 0.03;
    if(y > gameHeight) y = 0;
    star.style.top = y + 'px';
  });

  requestAnimationFrame(animateBackground);
}

/* ======= INITIALIZE BACKGROUND ======= */
spawnClouds();
spawnStars();
animateBackground();
</script>

