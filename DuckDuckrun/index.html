<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Pink Ducky Jumper</title>

<style>
:root{
  --bg:#ffd6ea;
  --ink:#2b1030;
  --shadow: rgba(0,0,0,.15);
}

*{ box-sizing:border-box; }

body{
  margin:0;
  min-height:100svh;
  display:grid;
  place-items:center;
  padding:
    env(safe-area-inset-top)
    env(safe-area-inset-right)
    env(safe-area-inset-bottom)
    env(safe-area-inset-left);
  background: radial-gradient(circle at 20% 20%, #ffe6f3 0%, var(--bg) 55%, #ffc4e2 100%);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color: var(--ink);
  touch-action: manipulation;
}

.wrap{
  width:min(520px, 92vw);
  padding:16px;
  background: rgba(255,255,255,.6);
  border:2px solid rgba(255,63,159,.35);
  border-radius:18px;
  box-shadow:0 14px 40px var(--shadow);
}

canvas{
  width:100%;
  image-rendering:pixelated;
  border-radius:14px;
  border:2px solid rgba(43,16,48,.12);
  background:linear-gradient(180deg,#ffe2f2 0%,#ffd0e8 55%,#ffbfdc 100%);
}
</style>
</head>

<body>
<div class="wrap">
  <canvas id="game" width="320" height="180"></canvas>
</div>

<script>
/* ========= CORE ========= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

const GROUND = 142;
const GRAVITY = .3;
const JUMP_V = -8.4;

let SPEED = 1.6;

/* ========= PLAYER ========= */
let duck;
let duckColorIndex = 0;
const DUCK_COLORS=["#fff6a6","#ffd1e8","#cdb4ff","#b8f2e6","#ffdac1","#2b1030"];

/* ========= GAME STATE ========= */
let frame = 0;
let score = 0;
let gameOver = false;
let skullMode = false;
let skullTimer = 0;
let showBaby404 = false;

/* ========= WORLD SYSTEM ========= */
let world = "runner"; // runner | tower

/* ========= RUNNER WORLD ========= */
let obstacles = [];

/* ========= SECRET DOOR ========= */
let secretDoor = null;

/* ========= TOWER WORLD ========= */
let platforms = [];
let fireY = 180;
let fireSpeed = 0.05;

/* ========= RESET ========= */
function resetGame(){
  duck = { x:60, y:GROUND-18, w:18, h:18, vy:0, onGround:true };
  obstacles = [];
  platforms = [];
  secretDoor = null;
  world = "runner";
  fireY = 180;
  fireSpeed = 0.05;

  frame = 0;
  score = 0;
  gameOver = false;
  skullMode = false;
  skullTimer = 0;
  showBaby404 = false;
}

/* ========= SPAWN ========= */
function spawnObstacle(){
  obstacles.push({
    x:340,
    w:12 + Math.random()*10,
    h:18 + Math.random()*22,
    passed:false
  });
}

function spawnSecretDoor(){
  secretDoor = {
    x:340,
    y:GROUND-24,
    w:20,
    h:24,
    hue:0
  };
}

function spawnPlatform(y){
  platforms.push({
    x: 40 + Math.random()*200,
    y,
    w: 40 + Math.random()*30,
    h: 6
  });
}

/* ========= INPUT ========= */
addEventListener("keydown",e=>{
  if(e.code==="Space" && duck.onGround && !gameOver){
    duck.vy = JUMP_V;
    duck.onGround = false;
  }
});
canvas.addEventListener("touchstart",e=>{
  e.preventDefault();
  if(duck.onGround && !gameOver){
    duck.vy = JUMP_V;
    duck.onGround = false;
  }
},{passive:false});

/* ========= COLLISION ========= */
function hit(a,b){
  return a.x < b.x + b.w &&
         a.x + a.w > b.x &&
         a.y + a.h > b.y &&
         a.y < b.y + b.h;
}

/* ========= UPDATE ========= */
function update(){
  frame++;

  if(skullMode && --skullTimer <= 0){
    showBaby404 = true;
  }

  if(gameOver){
    draw();
    requestAnimationFrame(update);
    return;
  }

  duck.vy += GRAVITY;
  duck.y += duck.vy;
  duck.onGround = false;

  /* ===== RUNNER WORLD ===== */
  if(world === "runner"){
    if(duck.y >= GROUND - duck.h){
      duck.y = GROUND - duck.h;
      duck.vy = 0;
      duck.onGround = true;
    }

    if(frame % 85 === 0) spawnObstacle();

    obstacles.forEach(o=>{
      o.x -= SPEED;

      if(!o.passed && o.x + o.w < duck.x){
        o.passed = true;
        score += 10;
      }

      if(
        duck.x < o.x + o.w &&
        duck.x + duck.w > o.x &&
        duck.y + duck.h > GROUND - o.h
      ){
        gameOver = true;
        skullMode = true;
        skullTimer = 45;
      }
    });

    // SECRET DOOR SPAWN
    if(score >= 150 && !secretDoor){
      spawnSecretDoor();
    }

    if(secretDoor){
      secretDoor.x -= SPEED;
      secretDoor.hue = (secretDoor.hue + 6) % 360;

      // WALK INTO DOOR
      if(
        duck.x + duck.w > secretDoor.x &&
        duck.x < secretDoor.x + secretDoor.w &&
        duck.onGround
      ){
        world = "tower";
        duck.y = 120;
        duck.vy = 0;
        platforms = [];
        for(let i=0;i<6;i++) spawnPlatform(140 - i*30);
        secretDoor = null;
      }
    }
  }

  /* ===== TOWER WORLD ===== */
  if(world === "tower"){
    platforms.forEach(p=>{
      if(
        duck.x + duck.w > p.x &&
        duck.x < p.x + p.w &&
        duck.y + duck.h >= p.y &&
        duck.y + duck.h <= p.y + 6 &&
        duck.vy >= 0
      ){
        duck.y = p.y - duck.h;
        duck.vy = 0;
        duck.onGround = true;
      }
    });

    if(duck.y < 60){
      duck.y += 40;
      platforms.forEach(p=>p.y += 40);
      spawnPlatform(0);
      score += 5;
    }

    fireY -= fireSpeed;
    fireSpeed += 0.0005;

    if(duck.y + duck.h > fireY){
      gameOver = true;
      skullMode = true;
      skullTimer = 45;
    }
  }

  draw();
  requestAnimationFrame(update);
}

/* ========= DRAW ========= */
function draw(){
  ctx.clearRect(0,0,320,180);

  if(showBaby404){
    ctx.fillStyle="#2b1030";
    ctx.font="28px monospace";
    ctx.textAlign="center";
    ctx.fillText("BABY404",160,90);
    return;
  }

  // background lines
  ctx.fillStyle="rgba(255,255,255,.35)";
  for(let i=0;i<6;i++) ctx.fillRect(0,20+i*18,320,6);

  if(world === "runner"){
    ctx.fillStyle="rgba(43,16,48,.15)";
    ctx.fillRect(0,GROUND,320,2);

    ctx.fillStyle="#ff3f9f";
    obstacles.forEach(o=>{
      ctx.fillRect(o.x,GROUND-o.h,o.w,o.h);
    });

    if(secretDoor){
      ctx.fillStyle=`hsl(${secretDoor.hue},100%,60%)`;
      ctx.fillRect(secretDoor.x, secretDoor.y, secretDoor.w, secretDoor.h);
    }
  }

  if(world === "tower"){
    ctx.fillStyle="#ff3b3b";
    ctx.fillRect(0,fireY,320,180-fireY);

    ctx.fillStyle="#ffd1e8";
    platforms.forEach(p=>{
      ctx.fillRect(p.x,p.y,p.w,p.h);
    });
  }

  // duck
  ctx.fillStyle=DUCK_COLORS[duckColorIndex];
  ctx.fillRect(duck.x,duck.y,duck.w,duck.h);
}

/* ========= START ========= */
resetGame();
update();
</script>
</body>
</html>
